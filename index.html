<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Konu≈üan Yapay Zeka</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f0f0;
      margin: 0;
      padding: 0;
      text-align: center;
    }

    #avatar {
      margin-top: 40px;
      width: 150px;
      height: 150px;
      border-radius: 50%;
      background: url('https://i.imgur.com/OGvN5bO.png') no-repeat center/cover;
      position: relative;
    }

    .eye, .mouth {
      position: absolute;
      background: black;
      border-radius: 50%;
    }

    .eye {
      width: 10px;
      height: 10px;
      top: 40px;
    }

    .eye.left {
      left: 40px;
    }

    .eye.right {
      right: 40px;
    }

    .mouth {
      width: 30px;
      height: 10px;
      bottom: 40px;
      left: 50%;
      transform: translateX(-50%);
    }

    #micButton {
      margin-top: 30px;
      width: 80px;
      height: 80px;
      background: red;
      border: none;
      border-radius: 50%;
      color: white;
      font-size: 30px;
    }

    #status {
      margin-top: 10px;
      font-weight: bold;
    }

    #log {
      margin: 20px auto;
      max-width: 500px;
      height: 200px;
      overflow-y: auto;
      background: white;
      border-radius: 10px;
      padding: 10px;
    }

    #settings {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #ccc;
      border-radius: 5px;
      padding: 5px 10px;
      cursor: pointer;
    }

    #language {
      margin-top: 10px;
    }

    #privacy {
      margin-top: 30px;
      font-size: 12px;
      color: gray;
    }
  </style>
</head>
<body>

<div id="settings" onclick="alert('Tema, dil ayarlarƒ± vs. yakƒ±nda!')">‚öôÔ∏è Ayarlar</div>

<div id="avatar">
  <div class="eye left"></div>
  <div class="eye right"></div>
  <div class="mouth" id="mouth"></div>
</div>

<div id="status">Hazƒ±r</div>

<button id="micButton">üé§</button>

<div id="language">
  <label for="lang">Dil Se√ß:</label>
  <select id="lang">
    <option value="tr-TR">T√ºrk√ße</option>
    <option value="en-US">English</option>
    <option value="zh-CN">‰∏≠Êñá (Chinese)</option>
  </select>
</div>

<div id="log"></div>

<div id="privacy">
  Bu uygulama seslerinizi dinlemez ve hi√ßbir veriniz kaydedilmez.
</div>

<script>
let recognition;
let isPressing = false;

const micButton = document.getElementById('micButton');
const statusText = document.getElementById('status');
const log = document.getElementById('log');
const langSelect = document.getElementById('lang');
const mouth = document.getElementById('mouth');

// Avatar hareketleri
function speakAvatar(on) {
  if (on) {
    mouth.style.height = "25px";
  } else {
    mouth.style.height = "10px";
  }
}

setInterval(() => {
  document.querySelectorAll('.eye').forEach(e => {
    e.style.visibility = Math.random() > 0.95 ? "hidden" : "visible";
  });
}, 300);

// Basƒ±lƒ± tutma
micButton.addEventListener('mousedown', () => {
  startListening();
});
micButton.addEventListener('mouseup', () => {
  stopListening();
});

// Dokunmatik cihazlar i√ßin
micButton.addEventListener('touchstart', (e) => {
  e.preventDefault();
  startListening();
});
micButton.addEventListener('touchend', (e) => {
  e.preventDefault();
  stopListening();
});

function startListening() {
  if (recognition) recognition.abort();
  const lang = langSelect.value;

  recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
  recognition.lang = lang;
  recognition.continuous = false;
  recognition.interimResults = false;

  statusText.textContent = "üéß Dinliyorum...";
  isPressing = true;

  recognition.onresult = function(event) {
    const transcript = event.results[0][0].transcript;
    logMessage("Sen", transcript);
    respond(transcript);
  };

  recognition.onerror = function() {
    statusText.textContent = "‚ö†Ô∏è Ses algƒ±lanamadƒ±.";
  };

  recognition.onend = function() {
    if (isPressing) {
      statusText.textContent = "‚ùå Erken bƒ±rakƒ±ldƒ±.";
    }
  };

  recognition.start();
}

function stopListening() {
  isPressing = false;
  if (recognition) recognition.stop();
}

function respond(text) {
  statusText.textContent = "ü§ñ Yanƒ±t olu≈üturuluyor...";
  fetch("https://api.openai.com/v1/chat/completions", {
    method: "POST",
    headers: {
      "Authorization": "Bearer SK-KEYƒ∞Nƒ∞Zƒ∞Gƒ∞Rƒ∞N",
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      model: "gpt-3.5-turbo",
      messages: [{ role: "user", content: text }]
    })
  })
  .then(res => res.json())
  .then(data => {
    const reply = data.choices[0].message.content;
    logMessage("Bot", reply);
    speak(reply, langSelect.value);
  })
  .catch(() => {
    statusText.textContent = "‚ùå Yanƒ±t alƒ±namadƒ±.";
  });
}

function speak(text, lang) {
  const utter = new SpeechSynthesisUtterance(text);
  utter.lang = lang;
  speakAvatar(true);
  utter.onend = () => {
    speakAvatar(false);
    statusText.textContent = "‚úÖ Hazƒ±r";
  };
  speechSynthesis.speak(utter);
}

function logMessage(speaker, message) {
  log.innerHTML += `<b>${speaker}:</b> ${message}<br>`;
  log.scrollTop = log.scrollHeight;
}
</script>
</body>
</html>
