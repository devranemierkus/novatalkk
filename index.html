<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Bas-Konuş AI Botu</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 40px;
      background: #f0f0f0;
      transition: background 0.3s;
    }

    #avatarContainer {
      width: 200px;
      height: 200px;
      margin: 20px auto;
      border-radius: 50%;
      background-image: url('https://i.imgur.com/9QxkVWI.png'); /* Avatar görseli */
      background-size: cover;
      background-position: center;
      box-shadow: 0 0 20px rgba(0,0,0,0.2);
    }

    #listenBtn {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background-color: crimson;
      color: white;
      font-size: 30px;
      border: none;
      cursor: pointer;
      margin-top: 30px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      transition: background 0.2s;
    }

    #listenBtn:active {
      background-color: darkred;
    }

    #log {
      margin-top: 20px;
      font-weight: bold;
      font-size: 18px;
      min-height: 40px;
    }
  </style>
</head>
<body>

  <h1>🤖 Sesli AI Asistan</h1>

  <div id="avatarContainer"></div>

  <button id="listenBtn">🎤</button>

  <div id="log">Basılı tut ve konuş!</div>

  <script>
    const listenBtn = document.getElementById('listenBtn');
    const logDiv = document.getElementById('log');

    let recognition;
    let isListening = false;

    // Ses tanıma kur
    function setupRecognition() {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SpeechRecognition) {
        alert("Tarayıcınız ses tanımayı desteklemiyor.");
        return;
      }

      recognition = new SpeechRecognition();
      recognition.lang = 'tr-TR';
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      recognition.onstart = () => {
        isListening = true;
        logDiv.textContent = "Dinliyorum...";
      };

      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript.trim();
        logDiv.textContent = `📥 Duyulan: "${transcript}"`;
        respond(transcript);
      };

      recognition.onerror = (event) => {
        logDiv.textContent = "❌ Hata: " + event.error;
      };

      recognition.onend = () => {
        isListening = false;
        logDiv.textContent += " | Dinleme bitti.";
      };
    }

    // Yanıt üret ve oku
    function respond(input) {
      let response = "";

      const lowerInput = input.toLowerCase();

      if (lowerInput.includes("merhaba")) {
        response = "Merhaba! Nasılsın?";
      } else if (lowerInput.includes("adın ne")) {
        response = "Ben ChatNova, senin sesli asistanınım.";
      } else if (lowerInput.includes("kaç yaşındasın")) {
        response = "Benim yaşım yapay zekaya göre ölçülüyor!";
      } else {
        response = "Seni tam anlayamadım, tekrar eder misin?";
      }

      speak(response);
    }

    // TTS konuşma
    function speak(text) {
      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = 'tr-TR';
      const voices = speechSynthesis.getVoices();
      const trVoice = voices.find(v => v.lang === 'tr-TR');
      if (trVoice) utter.voice = trVoice;
      speechSynthesis.speak(utter);
    }

    // Mikrofon izni
    function requestMicrophoneAccess() {
      navigator.mediaDevices.getUserMedia({ audio: true })
        .then(() => console.log("🎤 Mikrofon izni verildi."))
        .catch(() => alert("Mikrofon izni reddedildi."));
    }

    // Butona basılı tutulunca konuş
    listenBtn.addEventListener("mousedown", () => {
      if (!isListening) recognition.start();
    });

    // Bırakınca konuşmayı bitir
    listenBtn.addEventListener("mouseup", () => {
      if (isListening) recognition.stop();
    });

    // Dokunmatik cihazlar için
    listenBtn.addEventListener("touchstart", () => {
      if (!isListening) recognition.start();
    });

    listenBtn.addEventListener("touchend", () => {
      if (isListening) recognition.stop();
    });

    // Yüklenince
    window.onload = () => {
      setupRecognition();
      requestMicrophoneAccess();
      window.speechSynthesis.onvoiceschanged = () => {}; // Ses listesini güncelle
    };
  </script>

</body>
</html>
